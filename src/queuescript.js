var currentlySelected=0,premiumiconsrc=chrome.runtime.getURL("assets/icons/premium.png"),playiconsrc=chrome.runtime.getURL("assets/icons/openSelectedEpisode.svg");function prepareDOM(){document.getElementById("sidebar_elements").innerHTML="",document.getElementById("sortable").innerHTML="<style>#sortable div{color: black;}#sortable div li{position: relative;width: 960px;height: 150px;margin-bottom: 10px;border: none;border-radius: 5px;background-color: white;overflow: hidden;}#sortable div li:hover{background-color: rgba(255, 255, 255, 0.5);}#sortable div li .playbutton{position: absolute;top: 90px;left: 207px;width: 50px;height: 50px;border-radius: 25px;visibility: hidden;background-color: rgba(0,0,0,0.5);}#sortable div li:hover .playbutton{visibility: visible;}#sortable div li a{position: absolute;top: 0;left: 0;width: 960px;height: 150px;}#sortable div li img{position: absolute;top: 0;left: 0;width: auto;height: 150px;border: none;}#sortable div li .premiumIcon{position: absolute;top: 10px;left: 10px;width: 25px;height: 25px;}#sortable div li .premiumDate{position: absolute;top: 10px;left: 10px;padding-left: 25px;padding-right: 5px;font-size: 10pt;line-height: 25px;text-align: center;color: white;background-color: rgba(0,0,0,0.5);border-radius: 5px;}#sortable progress{position: absolute;-webkit-appearance: none;background-color: rgba(0,0,0,0);bottom: 0;left: 0;width: 960px;height: 5px;}#sortable progress[value]::-webkit-progress-bar{background-color: rgba(0,0,0,0);}#sortable progress[value]::-webkit-progress-value{background-color: orange;}#sortable .animeTitle{color: white;position: absolute;top: 5px;left: 275px;font-size: 11pt;padding: 0 5px;background-color: orange;}#sortable .episodeName{color: white;position: absolute;top: 23px;left: 275px;font-size: 13pt;padding: 0 5px;background-color: orange;font-weight: bold;}#sortable .episodeNumber{color: white;position: absolute;top: 44px;left: 275px;font-size: 10pt;padding: 0 5px;background-color: orange;}#sortable .description{position: absolute;top: 65px;left: 275px;height: 80px;overflow: hidden;}#sortable #cachedwarning{color: white;width: 960px;height: 17px;margin-top: -16px;margin-bottom: 16px;background-color: #f78c25;text-align: center;}#refreshbtn{position: fixed;bottom: 10px;right: 10px;width: 115px;height: 40px;border: none;border-radius: 25px;color: white;background-color: #f78c25;}#refreshbtn img{position: absolute;left: 10px;top: 0px;bottom: 0px;margin: auto;width: 30px;height: 30px;border: none;}#refreshbtn span{position: absolute;left: 40px;top: 0px;line-height: 40px;font-size: 13pt;}</style><div id='cachedwarning'>Cached</div><div id='watching'></div><div id='unseen' hidden></div><div id='done' hidden></div><div id='all' hidden></div><button id='refreshbtn' hidden><img src="+chrome.runtime.getURL("assets/icons/refresh.svg")+"><span>Refresh</span></button>",document.getElementsByClassName("main-tabs")[0].innerHTML="<a id='watchingbtn' class='left selected'>Watching</a><a id='unseenbtn' class='left'>Unseen</a><a id='donebtn' class='left'>Done</a><a id='allbtn' class='left'>All</a>"}function addEventListeners(){document.getElementById("refreshbtn").addEventListener("click",function(){refreshQueue()}),document.getElementById("watchingbtn").addEventListener("click",function(){changeTab(0)}),document.getElementById("unseenbtn").addEventListener("click",function(){changeTab(1)}),document.getElementById("donebtn").addEventListener("click",function(){changeTab(2)}),document.getElementById("allbtn").addEventListener("click",function(){changeTab(3)})}function addAnimesToDom(e){if(void 0!==e){e.sort((co1, co2) => co1['series']['name'].localeCompare(co2['series']['name']));var i=[],t=[],n=[],o=[];for(var a in e){var s=e[a];void 0===s.most_likely_media.playhead&&(s.most_likely_media.playhead=0),""!==s.most_likely_media.episode_number&&void 0!==s.most_likely_media.episode_number||(s.most_likely_media.episode_number="N/A");var d="<li name="+s.most_likely_media.name+"><a href="+s.most_likely_media.url+"><img src="+s.most_likely_media.screenshot_image.fwide_url+">";if(s.most_likely_media.premium_only){d+="<span class='premiumDate'>"+new Date(s.most_likely_media.free_available_time).toLocaleDateString(void 0,{weekday:"long",year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(new RegExp(",","g"),"")+"</span><img class='premiumIcon' src="+premiumiconsrc+">"}d+="<img class='playbutton' src="+playiconsrc+"><progress value="+s.most_likely_media.playhead+" max="+s.most_likely_media.duration+"></progress><div><span class='animeTitle'>"+s.series.name+"</span><span class='episodeName'>"+s.most_likely_media.name+"</span><span class='episodeNumber'> Episode Nr."+s.most_likely_media.episode_number+"</span><span class='description'>"+s.most_likely_media.description+"</span></div></a></li>",i.push(d),s.most_likely_media.playhead>=s.most_likely_media.duration-10?t.push(d):s.most_likely_media.playhead>0||1!=s.most_likely_media.episode_number?n.push(d):o.push(d)}document.getElementById("all").innerHTML=i.join(""),document.getElementById("done").innerHTML=t.join(""),document.getElementById("watching").innerHTML=n.join(""),document.getElementById("unseen").innerHTML=o.join("")}}function changeTab(e){e>=0&&e<=3&&(document.getElementsByClassName("main-tabs")[0].children[this.currentlySelected].classList.remove("selected"),document.getElementById("sortable").children[this.currentlySelected+2].hidden=!0,document.getElementsByClassName("main-tabs")[0].children[e].classList.add("selected"),document.getElementById("sortable").children[e+2].hidden=!1,this.currentlySelected=e)}function getLocalQueue(){chrome.storage.local.get(["animes"],function(e){addAnimesToDom(e.animes)})}function refreshQueue(){document.getElementById("refreshbtn").hidden=!0,chrome.runtime.sendMessage({data:"getCrunchyrollSessionCookie"},function(e){if(null!=e.sessionid){var i="https://api.crunchyroll.com/queue.0.json?&fields=most_likely_media,series,series.name,series.media_count,media.description,media.media_id,media.free_available_time,media.name,media.url,media.episode_number,series.url,media.screenshot_image,media.duration,media.playhead,media.premium_only,image.fwide_url&media_types=anime|drama&locale=enUS&session_id="+e.sessionid.value,t=new XMLHttpRequest;t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(addAnimesToDom(JSON.parse(t.responseText).data),document.getElementById("cachedwarning").hidden=!0,document.getElementById("refreshbtn").hidden=!1)},t.open("GET",i,!0),t.send(null)}})}prepareDOM(),addEventListeners(),getLocalQueue(),refreshQueue();
