var currentlySelected=0,premiumiconsrc=chrome.runtime.getURL("assets/icons/premium.png"),playiconsrc=chrome.runtime.getURL("assets/icons/openSelectedEpisode.svg");function prepareDOM(){document.getElementById("sidebar_elements").innerHTML="",document.getElementById("sortable").innerHTML="<div id='cachedwarning'>Cached</div><div id='watching'></div><div id='unseen' hidden></div><div id='done' hidden></div><div id='all' hidden></div><button id='refreshbtn' hidden><img src="+chrome.runtime.getURL("assets/icons/refresh.svg")+"><span>Refresh</span></button>",document.getElementsByClassName("main-tabs")[0].innerHTML="<a id='watchingbtn' class='left selected'>Watching</a><a id='unseenbtn' class='left'>Unseen</a><a id='donebtn' class='left'>Done</a><a id='allbtn' class='left'>All</a>",chrome.runtime.sendMessage({data:"injectContentScriptCss"})}function addEventListeners(){document.getElementById("refreshbtn").addEventListener("click",function(){refreshQueue()}),document.getElementById("watchingbtn").addEventListener("click",function(){changeTab(0)}),document.getElementById("unseenbtn").addEventListener("click",function(){changeTab(1)}),document.getElementById("donebtn").addEventListener("click",function(){changeTab(2)}),document.getElementById("allbtn").addEventListener("click",function(){changeTab(3)})}function addAnimesToDom(e){if(void 0!==e){e.sort((co1, co2) => co1['series']['name'].localeCompare(co2['series']['name']));var n=[],i=[],t=[],a=[];for(var d in e){var s=e[d],m="<li name="+s.most_likely_media.name+"><a href="+s.most_likely_media.url+"><img src="+s.most_likely_media.screenshot_image.fwide_url+">";void 0===s.most_likely_media.playhead&&(s.most_likely_media.playhead=0),s.most_likely_media.premium_only&&(m+="<span class='premiumDate'>"+new Date(s.most_likely_media.free_available_time).toLocaleDateString(void 0,{weekday:"long",year:"2-digit",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(new RegExp(",","g"),"")+"</span><img class='premiumIcon' src="+premiumiconsrc+">"),m+="<img class='playbutton' src="+playiconsrc+"><progress value="+s.most_likely_media.playhead+" max="+s.most_likely_media.duration+"></progress><div><span class='animeTitle'>"+s.series.name+"</span><span class='episodeName'>"+s.most_likely_media.name+"</span>",""===s.most_likely_media.episode_number&&void 0===s.most_likely_media.episode_number||(m+="<span class='episodeNumber'> Episode Nr."+s.most_likely_media.episode_number+"</span>"),m+="<span class='description'>"+s.most_likely_media.description+"</span></div></a></li>",n.push(m),s.most_likely_media.playhead>=s.most_likely_media.duration-10?i.push(m):s.most_likely_media.playhead>0||1!=s.most_likely_media.episode_number?t.push(m):a.push(m)}document.getElementById("all").innerHTML=n.join(""),document.getElementById("done").innerHTML=i.join(""),document.getElementById("watching").innerHTML=t.join(""),document.getElementById("unseen").innerHTML=a.join("")}}function changeTab(e){e>=0&&e<=3&&(document.getElementsByClassName("main-tabs")[0].children[this.currentlySelected].classList.remove("selected"),document.getElementById("sortable").children[this.currentlySelected+1].hidden=!0,document.getElementsByClassName("main-tabs")[0].children[e].classList.add("selected"),document.getElementById("sortable").children[e+1].hidden=!1,this.currentlySelected=e)}function getLocalQueue(){chrome.storage.local.get(["animes"],function(e){addAnimesToDom(e.animes)})}function refreshQueue(){document.getElementById("refreshbtn").hidden=!0,chrome.runtime.sendMessage({data:"getSessionId"},function(e){if(void 0!==e.sessionid){var n="https://api.crunchyroll.com/queue.0.json?&fields=most_likely_media,series,series.name,series.media_count,media.description,media.media_id,media.free_available_time,media.name,media.url,media.episode_number,series.url,media.screenshot_image,media.duration,media.playhead,media.premium_only,image.fwide_url&media_types=anime|drama&locale=enUS&session_id="+e.sessionid.value,i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&200==i.status&&(addAnimesToDom(JSON.parse(i.responseText).data),document.getElementById("cachedwarning").hidden=!0,document.getElementById("refreshbtn").hidden=!1)},i.open("GET",n,!0),i.send(null)}})}prepareDOM(),addEventListeners(),getLocalQueue(),refreshQueue();
